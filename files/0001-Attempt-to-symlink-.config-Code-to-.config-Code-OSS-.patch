From dfb729867a659b1a4fc40471450119b1c1ae7c8d Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Tue, 9 Oct 2018 20:00:36 +0300
Subject: [PATCH 1/1] Attempt to symlink .config/Code to .config/Code - OSS if
 Code does not exist. This ensures some extensions that specifically check for
 Code will function. Additionally don't bother doing the platform checks.
 We're on Linux.

---
 src/paths.js | 23 ++++++++++++++++-------
 1 file changed, 16 insertions(+), 7 deletions(-)

diff --git a/src/paths.js b/src/paths.js
index 33c691bf72..9df03fa79a 100644
--- a/src/paths.js
+++ b/src/paths.js
@@ -16,12 +16,7 @@ const os = require('os');
  * @returns {string}
  */
 function getAppDataPath(platform) {
-	switch (platform) {
-		case 'win32': return process.env['VSCODE_APPDATA'] || process.env['APPDATA'] || path.join(process.env['USERPROFILE'], 'AppData', 'Roaming');
-		case 'darwin': return process.env['VSCODE_APPDATA'] || path.join(os.homedir(), 'Library', 'Application Support');
-		case 'linux': return process.env['VSCODE_APPDATA'] || process.env['XDG_CONFIG_HOME'] || path.join(os.homedir(), '.config');
-		default: throw new Error('Platform not supported');
-	}
+	return process.env['VSCODE_APPDATA'] || process.env['XDG_CONFIG_HOME'] || path.join(os.homedir(), '.config');
 }
 
 /**
@@ -30,7 +25,21 @@ function getAppDataPath(platform) {
  */
 function getDefaultUserDataPath(platform) {
 	return path.join(getAppDataPath(platform), pkg.name);
+	var appDataPath = getAppDataPath(platform);
+	var codePath = path.join(appDataPath, pkg.name);
+
+	if (pkg.name == "Code - OSS") { // If we're using OSS equivalent
+		var codeNonOSSPath = path.join(appDataPath, "Code"); // Get the path for the non-Code equivalent
+
+		fs.access(codeNonOSSPath, fs.constants.F_OK, (error) => { // Access the folder with only the file exists constant
+			if (error) { // If the file does not exist
+				fs.symlinkSync(codePath, codeNonOSSPath); // Symlink the two
+			}
+		});
+	}
+
+	return codePath;
 }
 
 exports.getAppDataPath = getAppDataPath;
-exports.getDefaultUserDataPath = getDefaultUserDataPath;
\ No newline at end of file
+exports.getDefaultUserDataPath = getDefaultUserDataPath;
-- 
2.19.0

