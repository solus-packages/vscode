From 58b85a8c3b2cc79d3fbcc9b2327c8035dccfcaf9 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Fri, 24 Nov 2017 20:49:33 +0200
Subject: [PATCH 1/1] Attempt to symlink .config/Code to .config/Code - OSS if
 Code does not exist. This ensures some extensions that specifically check for
 Code will function. Additionally don't bother doing the platform checks.
 We're on Linux.

---
 src/paths.js | 25 +++++++++++++++++--------
 1 file changed, 17 insertions(+), 8 deletions(-)

diff --git a/src/paths.js b/src/paths.js
index 1fa7c625ee..17c8068a54 100644
--- a/src/paths.js
+++ b/src/paths.js
@@ -3,22 +3,31 @@
  *  Licensed under the MIT License. See License.txt in the project root for license information.
  *--------------------------------------------------------------------------------------------*/
 
+var fs = require('fs');
 var path = require('path');
 var os = require('os');
 var pkg = require('../package.json');
 
 function getAppDataPath(platform) {
-	switch (platform) {
-		case 'win32': return process.env['VSCODE_APPDATA'] || process.env['APPDATA'] || path.join(process.env['USERPROFILE'], 'AppData', 'Roaming');
-		case 'darwin': return process.env['VSCODE_APPDATA'] || path.join(os.homedir(), 'Library', 'Application Support');
-		case 'linux': return process.env['VSCODE_APPDATA'] || process.env['XDG_CONFIG_HOME'] || path.join(os.homedir(), '.config');
-		default: throw new Error('Platform not supported');
-	}
+	return process.env['VSCODE_APPDATA'] || process.env['XDG_CONFIG_HOME'] || path.join(os.homedir(), '.config');
 }
 
 function getDefaultUserDataPath(platform) {
-	return path.join(getAppDataPath(platform), pkg.name);
+	var appDataPath = getAppDataPath(platform);
+	var codePath = path.join(appDataPath, pkg.name);
+
+	if (pkg.name == "Code - OSS") { // If we're using OSS equivalent
+		var codeNonOSSPath = path.join(appDataPath, "Code"); // Get the path for the non-Code equivalent
+
+		fs.access(codeNonOSSPath, fs.constants.F_OK, (error) => { // Access the folder with only the file exists constant
+			if (error) { // If the file does not exist
+				fs.symlinkSync(codePath, codeNonOSSPath); // Symlink the two
+			}
+		});
+	}
+
+	return codePath;
 }
 
 exports.getAppDataPath = getAppDataPath;
-exports.getDefaultUserDataPath = getDefaultUserDataPath;
\ No newline at end of file
+exports.getDefaultUserDataPath = getDefaultUserDataPath;
-- 
2.15.0

